using System.Diagnostics;
using System.Linq;
using CodeSnippets;
using NUnit.Framework;

[TestFixture]
public class DocumentFileProcessorTests
{
    [Test]
    public void MissingKey()
    {
        var codeSnippets = new[]
            {
                new CodeSnippet
                    {
                        Key = "FoundKey1"
                    },
                new CodeSnippet
                    {
                        Key = "FoundKey2"
                    },
            };
        var codeSnippetReferences = DocumentFileProcessor.CheckMissingKeys(codeSnippets, "<!-- import MissingKey -->");
        var codeSnippetReference = codeSnippetReferences.First();
        Assert.AreEqual("MissingKey", codeSnippetReference.Key);
        Assert.AreEqual(1, codeSnippetReference.LineNumber);
    }

    [Test]
    public void MissingMultipleKeys()
    {
        var codeSnippets = new[]
            {
                new CodeSnippet
                    {
                        Key = "FoundKey1"
                    },
                new CodeSnippet
                    {
                        Key = "FoundKey2"
                    },
            };
        var codeSnippetReferences = DocumentFileProcessor.CheckMissingKeys(codeSnippets, "<!-- import MissingKey1 -->\r\n\r\n<!-- import MissingKey2 -->");
        var first = codeSnippetReferences.First();
        Assert.AreEqual("MissingKey1", first.Key);
        Assert.AreEqual(1, first.LineNumber);
        var second = codeSnippetReferences.Skip(1).First();
        Assert.AreEqual("MissingKey2", second.Key);
        Assert.AreEqual(3, second.LineNumber);
    }

    [Test]
    public void FoundKey()
    {
        var codeSnippets = new[]
            {
                new CodeSnippet
                    {
                        Key = "FoundKey1"
                    },
                new CodeSnippet
                    {
                        Key = "FoundKey2"
                    },
            };
        var codeSnippetReferences = DocumentFileProcessor.CheckMissingKeys(codeSnippets, "<!-- import FoundKey2 -->");
        Assert.IsEmpty(codeSnippetReferences);
    }

    [Test]
    public void FoundMultipleKeys()
    {
        var codeSnippets = new[]
            {
                new CodeSnippet
                    {
                        Key = "FoundKey1"
                    },
                new CodeSnippet
                    {
                        Key = "FoundKey2"
                    },
            };
        var codeSnippetReferences = DocumentFileProcessor.CheckMissingKeys(codeSnippets, "<!-- import FoundKey2 -->\r\b\n<!-- import FoundKey1 -->");
        Assert.IsEmpty(codeSnippetReferences);
    }

    [Test]
    public void LotsOfText()
    {
        var codeSnippets = new[]
            {
                new CodeSnippet
                    {
                        Key = "FoundKey1"
                    },
                new CodeSnippet
                    {
                        Key = "FoundKey2"
                    },
                new CodeSnippet
                    {
                        Key = "FoundKey4"
                    },
                new CodeSnippet
                    {
                        Key = "FoundKey7"
                    },
                new CodeSnippet
                    {
                        Key = "FoundKey2"
                    },
                new CodeSnippet
                    {
                        Key = "FoundKey5"
                    },
                new CodeSnippet
                    {
                        Key = "FoundKey1"
                    },
            };
        var startNew = Stopwatch.StartNew();
        var codeSnippetReferences = DocumentFileProcessor.CheckMissingKeys(codeSnippets, @"<!-- import FoundKey2 -->\r\b\n<!-- import FoundKey1 -->
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmgfkgjnfdjkgn<!-- import FoundKey1 -->
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg<!-- import FoundKey1 -->
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmg<!-- import FoundKey1 -->
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg<!-- import FoundKey1 -->
kdjrngkjfncgdflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg<!-- import FoundKey1 -->
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg<!-- import FoundKey1 -->
kdjrngkjfncgdflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmgfkgjnfdjkgn<!-- import FoundKey1 --><!-- import FoundKey1 -->
dflkgmxdklfmgkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmgfkgjnfdjkgn
dflkgmxdklfmgkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmdfgkjndfkjgngkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
kdjrngkjfncgdflkgmxdklfmgkdflxmg<!-- import FoundKey1 -->
kdjrngkjfncgdflkgmxdklfmgkdflxmg
dflkgmxdklfmgkdflxmg
lkmdflkgmxdklfmgkdflxmg
");
        Debug.WriteLine(startNew.ElapsedTicks);
    }
}